<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç®¡ç†è€…ãƒ†ãƒ³ãƒ—ãƒ¬ç·¨é›†ï¼ˆè‡ªå‹•ID & ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ï¼‰</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 800px; margin: auto; }
    input, button, textarea { font-size: 1em; margin-top: 0.5em; width: 100%; }
    textarea { height: 200px; }
  </style>
</head>
<body>
  <h1>ğŸ” ç®¡ç†è€…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†</h1>

  <label for="token">GitHubãƒˆãƒ¼ã‚¯ãƒ³ï¼š</label>
  <input type="password" id="token" placeholder="ghp_..." />
  <button onclick="saveToken()">ğŸ”’ ä¿å­˜</button>

  <label for="content">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…å®¹ï¼š</label>
  <textarea id="content"></textarea>

  <button onclick="loadGist()">ğŸ“¥ Gistèª­è¾¼</button>
  <button onclick="saveGist()">ğŸ’¾ Gistä¿å­˜</button>

  <p><a href="index.html">â† ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã«æˆ»ã‚‹</a></p>

  <script>
    async function getGistId() {
      const res = await fetch("gist.json");
      const json = await res.json();
      return json.gist_id;
    }

    function saveToken() {
      const token = document.getElementById('token').value.trim();
      localStorage.setItem('gist_token', token);
      alert("ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ï¼‰");
    }

    async function loadGist() {
      const gistId = await getGistId();
      const res = await fetch("https://api.github.com/gists/" + gistId);
      const data = await res.json();
      const fileKey = Object.keys(data.files)[0];
      document.getElementById('content').value = data.files[fileKey].content;
    }

    async function saveGist() {
      const token = localStorage.getItem('gist_token');
      if (!token) return alert("ãƒˆãƒ¼ã‚¯ãƒ³ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“");

      const gistId = await getGistId();
      const content = document.getElementById('content').value;

      const res = await fetch("https://api.github.com/gists/" + gistId, {
        method: 'PATCH',
        headers: {
          'Authorization': `token ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          files: {
            'template.txt': {
              content: content
            }
          }
        })
      });

      if (res.ok) {
        alert("ä¿å­˜ã—ã¾ã—ãŸï¼");
      } else {
        alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    }
  </script>
</body>
</html>
